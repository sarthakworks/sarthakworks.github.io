import{r as t,j as e}from"./index-DsSVuRm_.js";import{P as v}from"./PDFButton-DzLd8GsA.js";import{g as T,p as O,G as A}from"./pdf.worker.min-DHeGPavo.js";import{C as G}from"./Card-DSkqplbR.js";A.workerSrc=O;const q=()=>{const[o,k]=t.useState(null),[l,N]=t.useState(""),[g,i]=t.useState(null),[w,x]=t.useState(!1),[P,c]=t.useState(""),[b,y]=t.useState(!1),[p,F]=t.useState(!1),D=s=>{const a=s.target.files[0];a&&a.type==="application/pdf"?(k(a),i(null),c("")):alert("Please select a valid PDF file.")},U=async()=>{if(o){if(!l){c("Please enter the PDF password.");return}x(!0),c(""),i(null);try{const s=await o.arrayBuffer();if(b){const d=await T({data:new Uint8Array(s),password:l}).promise,h=d.numPages,r=await v.create();for(let u=1;u<=h;u++){const j=await d.getPage(u),f=j.getViewport({scale:1.5}),m=document.createElement("canvas"),B=m.getContext("2d");m.width=f.width,m.height=f.height,await j.render({canvasContext:B,viewport:f}).promise;const E=m.toDataURL("image/png"),L=await fetch(E).then(I=>I.arrayBuffer()),n=await r.embedPng(L);r.addPage([n.width,n.height]).drawImage(n,{x:0,y:0,width:n.width,height:n.height})}const C=await r.save(),R=new Blob([C],{type:"application/pdf"}),S=URL.createObjectURL(R);i(S)}else{const d=await(await v.load(s,{password:l})).save(),h=new Blob([d],{type:"application/pdf"}),r=URL.createObjectURL(h);i(r)}}catch(s){console.error("Error unlocking PDF:",s);const a=s.message||"";a.includes("Password")||a.includes("decrypt")||a.includes("encrypted")||a.name==="PasswordException"?c("Incorrect password or unsupported encryption. Try using 'Force Unlock' mode."):c("Failed to unlock PDF. The file might be corrupted or the password logic failed.")}finally{x(!1)}}};return e.jsxs("div",{className:"container-fluid",children:[e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"page-title-box",children:e.jsx("h4",{className:"page-title",children:"Remove PDF Password"})})})}),e.jsx("div",{className:"row justify-content-center",children:e.jsx("div",{className:"col-lg-8",children:e.jsxs(G,{title:"Remove PDF Password",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"pdf-upload",className:"form-label",children:"Select Protected PDF"}),e.jsx("input",{className:"form-control",type:"file",id:"pdf-upload",accept:"application/pdf",onChange:D})]}),o&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"pdf-password",className:"form-label",children:"Enter PDF Password"}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:p?"text":"password",className:"form-control",id:"pdf-password",placeholder:"Password",value:l,onChange:s=>N(s.target.value)}),e.jsx("button",{className:"btn btn-warning",type:"button",onClick:()=>F(!p),children:e.jsx("i",{className:p?"uil-eye-slash":"uil-eye"})})]})]}),o&&e.jsxs("div",{className:"form-check mb-3",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"force-mode",checked:b,onChange:s=>y(s.target.checked)}),e.jsxs("label",{className:"form-check-label",htmlFor:"force-mode",children:[e.jsx("strong",{children:"Force Unlock (Flatten PDF)"}),e.jsx("div",{className:"form-text mt-0",children:"Use this if standard unlocking fails (e.g., Aadhaar cards). It converts pages to images, removing all protection but making text unselectable."})]})]}),P&&e.jsx("div",{className:"alert alert-danger",children:P}),e.jsx("button",{className:"btn btn-warning w-100 fw-bold",onClick:U,disabled:!o||!l||w,children:w?"Unlocking...":"Unlock & Remove Password"}),g&&e.jsxs("div",{className:"mt-4 text-center",children:[e.jsxs("div",{className:"alert alert-success",children:[e.jsx("i",{className:"uil-unlock me-2"}),"Password removed successfully!"]}),e.jsxs("a",{href:g,download:`unlocked_${o.name}`,className:"btn btn-success",children:[e.jsx("i",{className:"uil-download-alt me-2"}),"Download Unlocked PDF"]})]})]})})})]})};export{q as default};
