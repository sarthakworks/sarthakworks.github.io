import{u as W,e as _,r as m,j as e}from"./index-CUU7AGCI.js";import{g as $,p as M,G as K}from"./pdf.worker.min-DHeGPavo.js";import{P as B}from"./PDFButton-CfUEN3nP.js";import{C as V}from"./Card-BzAKe0rG.js";K.workerSrc=M;const X=()=>{const{t:b}=W(),S=_(),[n,p]=m.useState([]),[j,N]=m.useState([]),[v,g]=m.useState(!1),[f,P]=m.useState(null),[D,i]=m.useState(null),[F,c]=m.useState(null),E=async t=>{const a=Array.from(t.target.files);if(a.length!==0){g(!0),i(null),c(null);try{const s=[...j],r=[...n];for(const d of a){if(d.type!=="application/pdf")continue;const l=s.push(d)-1,x=await d.arrayBuffer(),u=await $(x).promise,w=u.numPages;for(let o=1;o<=w;o++){const k=await u.getPage(o),y=k.getViewport({scale:.5}),h=document.createElement("canvas"),G=h.getContext("2d");h.height=y.height,h.width=y.width;const H={canvasContext:G,viewport:y};await k.render(H).promise;const L=h.toDataURL("image/png");r.push({id:await O(),fileIndex:l,pageIndex:o-1,pageNumber:o,thumbnail:L,fileName:d.name})}}N(s),p(r)}catch(s){console.error("Error loading PDF:",s),alert("Error loading PDF files.")}finally{g(!1)}}},O=async()=>Math.random().toString(36).substr(2,9),C=t=>{const a=[...n];a.splice(t,1),p(a),i(null),c(null)},I=(t,a)=>{if(a===-1&&t===0||a===1&&t===n.length-1)return;const s=[...n],r=s[t];s[t]=s[t+a],s[t+a]=r,p(s),i(null),c(null)},z=(t,a)=>{P(a),t.dataTransfer.effectAllowed="move"},U=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},R=(t,a)=>{if(t.preventDefault(),f===null||f===a)return;const s=[...n],r=s[f];s.splice(f,1),s.splice(a,0,r),p(s),P(null),i(null),c(null)},T=async()=>{if(n.length!==0){g(!0),i(null),c(null);try{const t=await B.create(),a={};for(const l of n){const x=j[l.fileIndex];if(!a[l.fileIndex]){const o=await x.arrayBuffer();a[l.fileIndex]=await B.load(o)}const u=a[l.fileIndex],[w]=await t.copyPages(u,[l.pageIndex]);t.addPage(w)}const s=await t.save(),r=new Blob([s],{type:"application/pdf"}),d=URL.createObjectURL(r);c(s),i(d)}catch(t){console.error("Error generating PDF:",t),alert("Error generating PDF.")}finally{g(!1)}}},A=()=>{if(!F)return;const t=new Blob([F],{type:"application/pdf"}),a=new File([t],"rearranged.pdf",{type:"application/pdf"});S("/pdf-tools/compress",{state:{file:a}})};return e.jsxs("div",{className:"container-fluid",children:[e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"page-title-box",children:e.jsx("h4",{className:"page-title",children:b("rearrange_pdf")||"Back To Organize & Edit PDF"})})})}),e.jsx("div",{className:"row justify-content-center",children:e.jsx("div",{className:"col-12",children:e.jsxs(V,{title:b("rearrange_pdf")||"Organize & Edit PDF",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"form-label btn btn-primary w-100",children:[e.jsx("i",{className:"mdi mdi-upload me-2"})," ",b("add_files")||"Add PDF Files to Merge/Organize",e.jsx("input",{type:"file",accept:"application/pdf",multiple:!0,onChange:E,hidden:!0})]}),e.jsx("p",{className:"text-muted small text-center mt-2",children:"Upload multiple files. Drag and drop pages to re-order. Output can be compressed."})]}),n.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h5",{className:"mb-0",children:["Total Pages: ",n.length]}),e.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>{p([]),N([])},children:"Clear All"})]}),e.jsx("div",{className:"row g-3",style:{maxHeight:"600px",overflowY:"auto"},children:n.map((t,a)=>e.jsx("div",{className:"col-6 col-sm-4 col-md-3 col-lg-2",draggable:!0,role:"button",tabIndex:0,"aria-label":`Page ${t.pageNumber} from ${t.fileName}`,onDragStart:s=>z(s,a),onDragOver:U,onDrop:s=>R(s,a),style:{opacity:f===a?.4:1,cursor:"move",transition:"opacity 0.2s",outline:"none"},onKeyDown:s=>{s.key==="ArrowLeft"&&I(a,-1),s.key==="ArrowRight"&&I(a,1),(s.key==="Delete"||s.key==="Backspace")&&C(a)},children:e.jsxs("div",{className:"card h-100 shadow-sm border position-relative",children:[e.jsxs("div",{className:"position-absolute top-0 start-0 p-1 bg-white rounded-bottom-end shadow-sm",style:{zIndex:10,fontSize:"0.7rem",maxWidth:"100%"},children:[e.jsx("div",{className:"text-truncate",style:{maxWidth:"80px"},title:t.fileName,children:t.fileName}),e.jsxs("div",{className:"fw-bold",children:["P ",t.pageNumber]})]}),e.jsx("button",{className:"btn btn-sm btn-danger position-absolute top-0 end-0 m-1 p-0 px-1 rounded-circle",style:{width:"24px",height:"24px",lineHeight:"1",zIndex:20},onClick:()=>C(a),title:"Remove Page",children:"Ã—"}),e.jsx("div",{className:"d-flex align-items-center justify-content-center bg-light border rounded grow",style:{minHeight:"150px"},children:e.jsx("img",{src:t.thumbnail,alt:`Page ${a+1}`,className:"img-fluid shadow-sm",style:{maxHeight:"140px"}})})]})},t.id))})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-success flex-grow-1 fw-bold py-2",onClick:T,disabled:n.length===0||v,children:v?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Generating PDF..."]}):"Generate PDF"}),D&&e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:D,download:"organized_document.pdf",className:"btn btn-primary fw-bold py-2",children:[e.jsx("i",{className:"mdi mdi-download me-1"})," Download"]}),e.jsxs("button",{className:"btn btn-info fw-bold py-2",onClick:A,title:"Feed to Compress Tool",children:[e.jsx("i",{className:"mdi mdi-zip-box-outline me-1"})," Compress Output"]})]})]})]})})})]})};export{X as default};
